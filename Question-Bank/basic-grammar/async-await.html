<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>async/await 用法整理 | Roundtable Coders</title>
    <meta name="description" content="A knowledge base created by ESOP-FED">
    <link rel="manifest" href="/Roundtable/manifest.json">
  <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/Roundtable/assets/css/0.styles.f83e9b7c.css" as="style"><link rel="preload" href="/Roundtable/assets/js/app.d395b3ed.js" as="script"><link rel="preload" href="/Roundtable/assets/js/2.a96cdc04.js" as="script"><link rel="preload" href="/Roundtable/assets/js/37.8c464367.js" as="script"><link rel="prefetch" href="/Roundtable/assets/js/10.4ab0a57a.js"><link rel="prefetch" href="/Roundtable/assets/js/11.ac4ef3a4.js"><link rel="prefetch" href="/Roundtable/assets/js/12.06d659e5.js"><link rel="prefetch" href="/Roundtable/assets/js/13.2ed0f1e0.js"><link rel="prefetch" href="/Roundtable/assets/js/14.029d4fd9.js"><link rel="prefetch" href="/Roundtable/assets/js/15.24dd9e93.js"><link rel="prefetch" href="/Roundtable/assets/js/16.460f1cc3.js"><link rel="prefetch" href="/Roundtable/assets/js/17.478da7f1.js"><link rel="prefetch" href="/Roundtable/assets/js/18.7faaa786.js"><link rel="prefetch" href="/Roundtable/assets/js/19.05fa366a.js"><link rel="prefetch" href="/Roundtable/assets/js/20.053f418e.js"><link rel="prefetch" href="/Roundtable/assets/js/21.32741730.js"><link rel="prefetch" href="/Roundtable/assets/js/22.fa9578c4.js"><link rel="prefetch" href="/Roundtable/assets/js/23.f54b48ac.js"><link rel="prefetch" href="/Roundtable/assets/js/24.68ef281e.js"><link rel="prefetch" href="/Roundtable/assets/js/25.3d141ae3.js"><link rel="prefetch" href="/Roundtable/assets/js/26.fe375428.js"><link rel="prefetch" href="/Roundtable/assets/js/27.533f5bcb.js"><link rel="prefetch" href="/Roundtable/assets/js/28.f1ca34cb.js"><link rel="prefetch" href="/Roundtable/assets/js/29.379df5bb.js"><link rel="prefetch" href="/Roundtable/assets/js/3.c7b181eb.js"><link rel="prefetch" href="/Roundtable/assets/js/30.09ad7e00.js"><link rel="prefetch" href="/Roundtable/assets/js/31.15637ddd.js"><link rel="prefetch" href="/Roundtable/assets/js/32.660e9ef0.js"><link rel="prefetch" href="/Roundtable/assets/js/33.2dcc0167.js"><link rel="prefetch" href="/Roundtable/assets/js/34.f38e2bc3.js"><link rel="prefetch" href="/Roundtable/assets/js/35.2f617305.js"><link rel="prefetch" href="/Roundtable/assets/js/36.a3389f31.js"><link rel="prefetch" href="/Roundtable/assets/js/38.3a25a918.js"><link rel="prefetch" href="/Roundtable/assets/js/39.9173b091.js"><link rel="prefetch" href="/Roundtable/assets/js/4.d77af3fd.js"><link rel="prefetch" href="/Roundtable/assets/js/40.f2f1950c.js"><link rel="prefetch" href="/Roundtable/assets/js/41.c1755e18.js"><link rel="prefetch" href="/Roundtable/assets/js/42.67bc835a.js"><link rel="prefetch" href="/Roundtable/assets/js/43.967002eb.js"><link rel="prefetch" href="/Roundtable/assets/js/44.09429888.js"><link rel="prefetch" href="/Roundtable/assets/js/45.e9ce7463.js"><link rel="prefetch" href="/Roundtable/assets/js/46.6012eee8.js"><link rel="prefetch" href="/Roundtable/assets/js/47.1fe01709.js"><link rel="prefetch" href="/Roundtable/assets/js/48.6651cdf5.js"><link rel="prefetch" href="/Roundtable/assets/js/49.341914e8.js"><link rel="prefetch" href="/Roundtable/assets/js/5.5286312b.js"><link rel="prefetch" href="/Roundtable/assets/js/50.ca77c81b.js"><link rel="prefetch" href="/Roundtable/assets/js/51.4588c7f2.js"><link rel="prefetch" href="/Roundtable/assets/js/52.2878d64e.js"><link rel="prefetch" href="/Roundtable/assets/js/53.b6020070.js"><link rel="prefetch" href="/Roundtable/assets/js/54.2a35ade4.js"><link rel="prefetch" href="/Roundtable/assets/js/55.11a909d8.js"><link rel="prefetch" href="/Roundtable/assets/js/56.b30c0b97.js"><link rel="prefetch" href="/Roundtable/assets/js/57.03ae6827.js"><link rel="prefetch" href="/Roundtable/assets/js/58.1a038e90.js"><link rel="prefetch" href="/Roundtable/assets/js/59.2da21658.js"><link rel="prefetch" href="/Roundtable/assets/js/6.b88910a4.js"><link rel="prefetch" href="/Roundtable/assets/js/60.fe9989a0.js"><link rel="prefetch" href="/Roundtable/assets/js/61.02171fc2.js"><link rel="prefetch" href="/Roundtable/assets/js/62.3ac82e59.js"><link rel="prefetch" href="/Roundtable/assets/js/63.5ffcb8d6.js"><link rel="prefetch" href="/Roundtable/assets/js/64.c37100d7.js"><link rel="prefetch" href="/Roundtable/assets/js/65.17e9b801.js"><link rel="prefetch" href="/Roundtable/assets/js/66.2b151938.js"><link rel="prefetch" href="/Roundtable/assets/js/67.0a59b1c4.js"><link rel="prefetch" href="/Roundtable/assets/js/68.1ffc7a32.js"><link rel="prefetch" href="/Roundtable/assets/js/69.3c0dbb67.js"><link rel="prefetch" href="/Roundtable/assets/js/7.220af8d5.js"><link rel="prefetch" href="/Roundtable/assets/js/8.0ea184b4.js"><link rel="prefetch" href="/Roundtable/assets/js/9.f9c64785.js">
    <link rel="stylesheet" href="/Roundtable/assets/css/0.styles.f83e9b7c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Roundtable/" class="home-link router-link-active"><!----> <span class="site-name">Roundtable Coders</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Roundtable/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Roundtable/Question-Bank/" class="nav-link router-link-active">题库</a></div><div class="nav-item"><a href="/Roundtable/Lets-Read/" class="nav-link">共读</a></div><div class="nav-item"><a href="/Roundtable/Wanted/" class="nav-link">通缉令</a></div><div class="nav-item"><a href="/Roundtable/Quest-SC/" class="nav-link">源码探秘</a></div><div class="nav-item"><a href="/Roundtable/Algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="https://esop-fed.github.io/ani-css/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Ani-Css
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="blog" class="dropdown-title"><span class="title">blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://johninch.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  johninch
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dannisi.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Caleb
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://niannings.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  niannings
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://Xmtd.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Xmtd
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://febcat.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  febcat
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="github" class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/johninch/Roundtable" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Roundtable
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/esop-fed" target="_blank" rel="noopener noreferrer" class="nav-link external">
  esop-fed
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/johninch" target="_blank" rel="noopener noreferrer" class="nav-link external">
  johninch
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/dannisi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Caleb
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/niannings" target="_blank" rel="noopener noreferrer" class="nav-link external">
  niannings
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Xmtd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Xmtd
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/febcat" target="_blank" rel="noopener noreferrer" class="nav-link external">
  febcat
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Roundtable/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Roundtable/Question-Bank/" class="nav-link router-link-active">题库</a></div><div class="nav-item"><a href="/Roundtable/Lets-Read/" class="nav-link">共读</a></div><div class="nav-item"><a href="/Roundtable/Wanted/" class="nav-link">通缉令</a></div><div class="nav-item"><a href="/Roundtable/Quest-SC/" class="nav-link">源码探秘</a></div><div class="nav-item"><a href="/Roundtable/Algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="https://esop-fed.github.io/ani-css/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Ani-Css
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="blog" class="dropdown-title"><span class="title">blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://johninch.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  johninch
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dannisi.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Caleb
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://niannings.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  niannings
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://Xmtd.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Xmtd
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://febcat.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  febcat
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="github" class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/johninch/Roundtable" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Roundtable
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/esop-fed" target="_blank" rel="noopener noreferrer" class="nav-link external">
  esop-fed
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/johninch" target="_blank" rel="noopener noreferrer" class="nav-link external">
  johninch
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/dannisi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Caleb
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/niannings" target="_blank" rel="noopener noreferrer" class="nav-link external">
  niannings
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/Xmtd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Xmtd
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/febcat" target="_blank" rel="noopener noreferrer" class="nav-link external">
  febcat
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Roundtable/Question-Bank/" class="sidebar-link">题库 Question-Bank</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基本语法</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Roundtable/Question-Bank/basic-grammar/variablesAndTypes1.html" class="sidebar-link">JS专题-变量与类型-(1)JS数据类型</a></li><li><a href="/Roundtable/Question-Bank/basic-grammar/variablesAndTypes2.html" class="sidebar-link">JS专题-变量与类型-(2)JS 3种疑难基础类型</a></li><li><a href="/Roundtable/Question-Bank/basic-grammar/number.html" class="sidebar-link">javascript数值</a></li><li><a href="/Roundtable/Question-Bank/basic-grammar/variablesAndTypes3.html" class="sidebar-link">JS专题-变量与类型-(3)JS 其他引用类型</a></li><li><a href="/Roundtable/Question-Bank/basic-grammar/variablesAndTypes4.html" class="sidebar-link">JS专题-变量与类型-(4)JS的类型转换</a></li><li><a href="/Roundtable/Question-Bank/basic-grammar/variablesAndTypes5.html" class="sidebar-link">JS专题-变量与类型-(5)JS的类型判断方法</a></li><li><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html" class="active sidebar-link">async/await 用法整理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html#_1、async-await-概念解释" class="sidebar-link">1、async/await 概念解释</a></li><li class="sidebar-sub-header"><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html#_2、async函数是generator函数的语法糖，并对generator函数进行了改进。" class="sidebar-link">2、async函数是Generator函数的语法糖，并对Generator函数进行了改进。</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html#generator函数" class="sidebar-link">Generator函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html#_2、async-await-与-promise-相比的优势" class="sidebar-link">2、async/await 与 promise 相比的优势</a></li><li class="sidebar-sub-header"><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html#_3、async关键字" class="sidebar-link">3、async关键字</a></li><li class="sidebar-sub-header"><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html#_4、await关键字" class="sidebar-link">4、await关键字</a></li><li class="sidebar-sub-header"><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html#_5、使用方式实践" class="sidebar-link">5、使用方式实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html#（1）像写同步代码那样，定义异步流程" class="sidebar-link">（1）像写同步代码那样，定义异步流程</a></li><li class="sidebar-sub-header"><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html#（2）顺序执行，结果作为下一次输入" class="sidebar-link">（2）顺序执行，结果作为下一次输入</a></li><li class="sidebar-sub-header"><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html#（3）中间参数需要保留" class="sidebar-link">（3）中间参数需要保留</a></li></ul></li><li class="sidebar-sub-header"><a href="/Roundtable/Question-Bank/basic-grammar/async-await.html#_6、关于协程" class="sidebar-link">6、关于协程</a></li></ul></li><li><a href="/Roundtable/Question-Bank/basic-grammar/flatten-array.html" class="sidebar-link">数组扁平化</a></li><li><a href="/Roundtable/Question-Bank/basic-grammar/deep-clone.html" class="sidebar-link">完美深拷贝</a></li><li><a href="/Roundtable/Question-Bank/basic-grammar/deep-query.html" class="sidebar-link">深度查询实现</a></li><li><a href="/Roundtable/Question-Bank/basic-grammar/chain-methods.html" class="sidebar-link">链式调用实现</a></li><li><a href="/Roundtable/Question-Bank/basic-grammar/callback-hell.html" class="sidebar-link">解决回调地狱</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端性能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>包管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>运维相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工作实践</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PWA</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="async-await-用法整理"><a href="#async-await-用法整理" aria-hidden="true" class="header-anchor">#</a> async/await 用法整理</h1> <p>它最受欢迎的地方：<strong>能让异步代码写起来像同步代码，并且方便控制顺序。</strong></p> <h2 id="_1、async-await-概念解释"><a href="#_1、async-await-概念解释" aria-hidden="true" class="header-anchor">#</a> 1、async/await 概念解释</h2> <ul><li><p>async</p> <blockquote><p>async的用法，它作为一个关键字放到函数前面，用于表示函数是一个异步函数，因为async就是异步的意思， 异步函数也就意味着该函数的执行不会阻塞后面代码的执行，async 函数返回的是一个promise 对象。</p></blockquote></li> <li><p>await</p> <blockquote><p>await的含义为等待。意思就是代码需要等待await后面的函数运行完并且有了返回结果之后，才继续执行下面的代码。这正是同步的效果。</p></blockquote></li></ul> <h2 id="_2、async函数是generator函数的语法糖，并对generator函数进行了改进。"><a href="#_2、async函数是generator函数的语法糖，并对generator函数进行了改进。" aria-hidden="true" class="header-anchor">#</a> 2、async函数是Generator函数的语法糖，并对Generator函数进行了改进。</h2> <h3 id="generator函数"><a href="#generator函数" aria-hidden="true" class="header-anchor">#</a> Generator函数</h3> <h4 id="简介"><a href="#简介" aria-hidden="true" class="header-anchor">#</a> <em>简介</em></h4> <ul><li>Generator 函数是一个状态机，封装了多个内部状态。执行Generator函数会返回一个<a href="http://es6.ruanyifeng.com/#docs/iterator" target="_blank" rel="noopener noreferrer">遍历器对象<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可以依次遍历Generator函数的每一个状态，
但是只有调用<code>next</code>方法才能遍历到下一个状态，所以其实提供了一种暂停执行函数，<code>yield</code>表达式就是暂停标志。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'world'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">'ending'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> hw <span class="token operator">=</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// { value: 'hello', done: false }</span>
hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// { value: 'world', done: false }</span>
hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// { value: 'ending', done: true }</span>
hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// { value: undefined, done: true }</span>
</code></pre></div><p>可以看出，helloWorldGenerator函数被调用时并没有执行，而是返回了一个遍历器对象，只有调用<code>next</code>方法、内部指针指向该语句时才执行，每次调用next方法，就回返回一个对象包含<code>value</code>和
<code>done</code>两个属性，<code>value</code>属性表示内部状态的值，是yield表达式后面表达式返回的值；<code>done</code>属性是个布尔值，表示是否遍历结束。即实现了<code>函数可以暂停，也可恢复执行</code></p> <h4 id="generator暂停恢复执行原理"><a href="#generator暂停恢复执行原理" aria-hidden="true" class="header-anchor">#</a> <em>Generator暂停恢复执行原理</em></h4> <p>要懂得原理，得了解协程的概念</p> <blockquote><p>一个线程（或函数）执行到一半，可以暂停执行，将执行权交给另一个线程（或函数），
等到稍后收回执行权的时候，再恢复执行。这种可以并行执行、交换执行权的线程（或函数），就称为协程。</p></blockquote> <p>协程是一种比线程更加轻量级的存在。普通线程是抢先式的，会争夺cpu资源，而协程是合作的，可以把协程看成是跑在线程上的任务，一个线程上可以存在多个协程，但是在线程上同时只能执行一个协程。它的运行流程大致如下：</p> <ol><li>协程A开始执行</li> <li>协程A执行到某个阶段，进入暂停，执行权转移到协程B</li> <li>协程B执行完成或暂停，将执行权交还A</li> <li>协程A恢复执行</li></ol> <p>协程遇到yield命令就暂停，等到执行权返回，再从暂停的地方继续往后执行。它的最大优点，就是代码的写法非常像同步操作，如果去除yield命令，简直一模一样。</p> <h4 id="执行器"><a href="#执行器" aria-hidden="true" class="header-anchor">#</a> <em>执行器</em></h4> <p>通常，我们把执行生成器的代码封装成一个函数，并把这个执行生成器代码的函数称为执行器,<code>co</code> 模块就是一个著名的执行器。</p> <p>Generator 是一个异步操作的容器。它是需要手动执行的，它的自动执行需要一种机制，当异步操作有了结果，能够自动交回执行权。两种方法可以做到这一点：</p> <pre><code>1. 回调函数。将异步操作包装成 Thunk 函数，在回调函数里面交回执行权。
2. Promise 对象。将异步操作包装成 Promise 对象，用then方法交回执行权
</code></pre> <p>一个基于 Promise 对象的简单自动执行器：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span> result<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

使用：
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> response1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://xxx'</span><span class="token punctuation">)</span> <span class="token comment">//返回promise对象</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'response1'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response1<span class="token punctuation">)</span>
    <span class="token keyword">let</span> response2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://xxx'</span><span class="token punctuation">)</span> <span class="token comment">//返回promise对象</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'response2'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">run</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，只要 Generator 函数还没执行到最后一步，next函数就调用自身，以此实现自动执行。</p> <h4 id="async的改进"><a href="#async的改进" aria-hidden="true" class="header-anchor">#</a> <em>async的改进</em></h4> <p>async彻底告别了执行器和生成器，实现更加直观简洁的代码，async 是一个通过异步执行并隐式返回 Promise 作为结果的函数。可以说async 是Generator函数的语法糖，并对Generator函数进行了改进。</p> <p>async函数对 Generator 函数的改进，体现在以下四点：</p> <pre><code>1. 内置执行器。Generator 函数的执行必须依靠执行器，而 async 函数自带执行器，无需手动执行 next() 方法。
2. 更好的语义。async和await，比起星号和yield，语义更清楚了。async表示函数里有异步操作，await表示紧跟在后面的表达式需要等待结果
3. 更广的适用性。co模块约定，yield命令后面只能是 Thunk 函数或 Promise 对象，而async函数的await命令后面，可以是 Promise 对象和原始类型的值（数值、字符串和布尔值，但这时会自动转成立即 resolved 的 Promise 对象）。
4. 返回值是 Promise。async 函数返回值是 Promise 对象，比 Generator 函数返回的 Iterator 对象方便，可以直接使用 then() 方法进行调用
</code></pre> <h2 id="_2、async-await-与-promise-相比的优势"><a href="#_2、async-await-与-promise-相比的优势" aria-hidden="true" class="header-anchor">#</a> 2、async/await 与 promise 相比的优势</h2> <ol><li><p><strong>同步代码编写方式</strong>:</p> <ul><li>用同步的思维来解决异步问题的方案。</li> <li>Promise使用then函数进行链式调用，一直点点点，是一种从左向右的横向写法；</li> <li>async/await从上到下，顺序执行，就像写同步代码一样，更符合代码编写习惯。</li></ul></li> <li><p><strong>多个参数传递</strong>:</p> <ul><li>Promise的then函数只能传递一个参数，虽然可以通过包装成对象来传递多个参数，但是会导致传递冗余信息，比较麻烦；</li> <li>async/await没有这个限制，可以当做普通的局部变量来处理，用let或者const定义的块级变量想怎么用就怎么用，完全没有限制；</li></ul></li> <li><p><strong>同步代码和异步代码可以一起编写</strong>:</p> <ul><li>使用Promise的时候最好将同步代码和异步代码放在不同的then节点中，这样结构更加清晰；</li> <li>async/await整个书写习惯都是同步的，不需要纠结同步和异步的区别，当然，异步过程需要包装成一个Promise对象放在await关键字后面；</li></ul></li> <li><p><strong>基于协程</strong>:</p> <ul><li>Promise是根据函数式编程的范式，对异步过程进行了一层封装；</li> <li>async/await基于协程的机制，是真正的“保存上下文，控制权切换……控制权恢复，取回上下文”这种机制，是对异步过程更精确的一种描述；</li></ul></li> <li><p>✨<strong>这点并不是优势也不算劣势（只能串行）</strong>:
它不能取代 Promise，尤其是我们可以很方便地用Promise.all()来实现并发，而async/await只能实现串行。</p></li></ol> <h2 id="_3、async关键字"><a href="#_3、async关键字" aria-hidden="true" class="header-anchor">#</a> 3、async关键字</h2> <blockquote><p>async函数执行和普通函数一样，函数名带个()就可以了，参数个数随意，没有限制，也需要有async关键字；只是返回值是一个Promise对象，可以用then函数得到返回值，用catch抓整个流程中发生的错误；</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello async&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个Promise对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// async函数返回的是一个Promise对象，async函数（包括函数语句、函数表达式、Lambda表</span>
<span class="token comment">// 达式）会返回一个Promise对象，如果在函数中return一个直接量，async会把这个直接量通</span>
<span class="token comment">// 过Promise.resolve() 封装成 Promise 对象；</span>


<span class="token comment">// async函数返回的是一个Promise对象，所以在最外层不能用await获取其返回值的情况，</span>
<span class="token comment">// 应该使用原始的方式：then()链来处理这个Promise对象</span>
<span class="token function">testAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出 hello async</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li><p><strong>表明程序里面可能有异步过程：</strong></p> <ul><li>async关键字表明程序里面可能有异步过程，里面可以有await关键字；</li> <li>当然全部是同步代码也没关系，但是这样async关键字就显得多余了；</li></ul></li> <li><p><strong>非阻塞，无等待：</strong></p> <ul><li>async函数里面如果有异步过程会等待，但是<code>async函数本身会马上返回</code>，不会阻塞当前线程;</li> <li>可以简单认为，async函数工作在主线程，同步执行，不会阻塞界面渲染，async函数内部由await关键字修饰的异步过程，工作在相应的协程上，会阻塞等待异步任务的完成再返回；</li> <li>在没有await的情况下执行async函数，它会立即执行，返回一个Promise对象，并且绝对不会阻塞后面的语句，这和普通返回Promise对象的函数并无二致；</li></ul></li> <li><p><strong>async函数返回类型为Promise对象：</strong>
这是和普通函数本质上不同的地方，也是使用时重点注意的地方；</p> <ul><li>（1）return newPromise()；这个符合async函数本意；</li> <li>（2）return data；这个是同步函数的写法，这里是要特别注意的，这个时候，其实就相当于Promise.resolve(data)；还是一个Promise对象，但是在调用async函数的地方通过简单的=是拿不到这个data的，因为返回值是一个Promise对象，所以需要用.then(data =&gt; { })函数才可以拿到这个data；</li> <li>（3）如果没有返回值，相当于返回了Promise.resolve(undefined)；</li></ul></li> <li><p><strong>async统一catch，await不处理异步error：</strong>
async函数返回的这个Promise对象的catch函数负责统一抓取内部所有异步过程的错误，await是不管异步过程的reject(error)消息的；</p></li></ol> <h2 id="_4、await关键字"><a href="#_4、await关键字" aria-hidden="true" class="header-anchor">#</a> 4、await关键字</h2> <ol><li><p><strong>await只能在async函数内部使用：</strong>
不能放在普通函数里面，否则会报错；</p></li> <li><p><strong>await后面也可以跟同步代码：</strong>
不过系统会自动将其转化成一个Promsie对象，比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token string">'hello world'</span>

<span class="token comment">// 相当于</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 跟同步代码是一样的，还不如省事点，直接去掉await关键字</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>✨<strong>await对于失败消息的处理：</strong>
await只关心异步过程成功的消息resolve(data)，拿到相应的数据data，至于失败消息reject(error)，不关心不处理；对于错误的处理有以下几种方法供选择：</p> <ol><li>让await后面的Promise对象自己catch；</li> <li>也可以让外面的async函数返回的Promise对象统一catch；</li> <li>像同步代码一样，放在一个try...catch结构中；</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 这是React Native的回调函数，加个async关键字，没有任何影响，但是可以用await关键字</span>
<span class="token keyword">async</span> <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将异步和同步的代码放在一个try..catch中，异常都能抓到</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">asyncFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 这里用await关键字，就能拿到结果值；否则，没有await的话，只能拿到Promise对象</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 这里会抛出异常，下面的catch也能抓到</span>
            array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h2 id="_5、使用方式实践"><a href="#_5、使用方式实践" aria-hidden="true" class="header-anchor">#</a> 5、使用方式实践</h2> <h3 id="（1）像写同步代码那样，定义异步流程"><a href="#（1）像写同步代码那样，定义异步流程" aria-hidden="true" class="header-anchor">#</a> （1）像写同步代码那样，定义异步流程</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 异步过程封装</span>
<span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token parameter">ms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'sleep for '</span> <span class="token operator">+</span> ms <span class="token operator">+</span> <span class="token string">' ms'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义异步流程，就像写同步代码那样</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">asyncFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'asyncFunction total executing:'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> sleep1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sleep1: '</span> <span class="token operator">+</span> sleep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>sleep2<span class="token punctuation">,</span> sleep3<span class="token punctuation">,</span> sleep4<span class="token punctuation">]</span><span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sleep2: '</span> <span class="token operator">+</span> sleep2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sleep3: '</span> <span class="token operator">+</span> sleep3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sleep4: '</span> <span class="token operator">+</span> sleep4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> sleepRace <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sleep race: '</span> <span class="token operator">+</span> sleepRace<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'asyncFunction total executing:'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token string">'asyncFunction done.'</span>  <span class="token comment">// 这个可以不返回，这里只是做个标记，为了显示流程</span>
<span class="token punctuation">}</span>

<span class="token comment">// 像普通函数调用async函数，在then函数中获取整个流程的返回信息，</span>
<span class="token comment">// 在catch函数统一处理出错信息</span>
<span class="token function">asyncFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// asyncFunction return 的内容在这里获取: 'asyncFunction done.'</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// asyncFunction 的错误统一在这里抓取</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 这个代表asyncFunction函数后的代码，</span>
<span class="token comment">// 显示asyncFunction本身会立即返回，不会阻塞主线程</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'after asyncFunction code executing....'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 执行结果</span>
after asyncFunction code executing<span class="token operator">...</span><span class="token punctuation">.</span>
sleep1<span class="token punctuation">:</span> sleep <span class="token keyword">for</span> <span class="token number">2000</span> ms
sleep2<span class="token punctuation">:</span> sleep <span class="token keyword">for</span> <span class="token number">2000</span> ms
sleep3<span class="token punctuation">:</span> sleep <span class="token keyword">for</span> <span class="token number">1000</span> ms
sleep4<span class="token punctuation">:</span> sleep <span class="token keyword">for</span> <span class="token number">1500</span> ms
sleep race<span class="token punctuation">:</span> sleep <span class="token keyword">for</span> <span class="token number">1000</span> ms
asyncFunction total executing<span class="token punctuation">:</span><span class="token punctuation">:</span> <span class="token number">5006.276123046875</span>ms
asyncFunction done<span class="token punctuation">.</span>

<span class="token comment">// console输出：</span>
Promise <span class="token punctuation">{</span><span class="token operator">&lt;</span>pending<span class="token operator">&gt;</span><span class="token punctuation">}</span>
    __proto__<span class="token punctuation">:</span> Promise
    <span class="token punctuation">[</span><span class="token punctuation">[</span>PromiseStatus<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;resolved&quot;</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>PromiseValue<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;asyncFunction done.&quot;</span>
<span class="token constant">VM12229</span><span class="token punctuation">:</span><span class="token number">5</span> sleep1<span class="token punctuation">:</span> sleep <span class="token keyword">for</span> <span class="token number">2000</span> ms
<span class="token constant">VM12229</span><span class="token punctuation">:</span><span class="token number">7</span> sleep2<span class="token punctuation">:</span> sleep <span class="token keyword">for</span> <span class="token number">2000</span> ms
<span class="token constant">VM12229</span><span class="token punctuation">:</span><span class="token number">8</span> sleep3<span class="token punctuation">:</span> sleep <span class="token keyword">for</span> <span class="token number">1000</span> ms
<span class="token constant">VM12229</span><span class="token punctuation">:</span><span class="token number">9</span> sleep4<span class="token punctuation">:</span> sleep <span class="token keyword">for</span> <span class="token number">1500</span> ms
<span class="token constant">VM12229</span><span class="token punctuation">:</span><span class="token number">11</span> sleep race<span class="token punctuation">:</span> sleep <span class="token keyword">for</span> <span class="token number">1000</span> ms
<span class="token constant">VM12229</span><span class="token punctuation">:</span><span class="token number">12</span> asyncFunction total executing<span class="token punctuation">:</span><span class="token punctuation">:</span> <span class="token number">5004.796875</span>ms
</code></pre></div><p>代码分析：</p> <ul><li>after asyncFunction code executing....代码位置在async函数asyncFunction()调用之后，反而先输出，这说明async函数asyncFunction()调用之后会马上返回，不会阻塞主线程；</li> <li>sleep1: sleep for 2000 ms这是第一个await之后的第一个异步过程，最先执行，也最先完成，说明后面的代码，不论是同步和异步，都在等他执行完毕；</li> <li>sleep2 ~ sleep4这是第二个await之后的Promise.all()异步过程，这是“比慢模式”，三个sleep都完成后，再运行下面的代码，耗时最长的是2000ms；</li> <li>sleep race: sleep for 1000 ms这是第三个await之后的Promise.race()异步过程，这是“比快模式”，耗时最短sleep都完成后，就运行下面的代码，耗时最短的是1000ms；</li> <li>asyncFunction total executing:: 5006.276123046875ms这是最后的统计总共运行时间代码，三个await之后的异步过程之和：
<blockquote><p>1000（独立的） + 2000（Promise.all） + 1000（Promise.race） = 5000ms</p></blockquote></li> <li>这个和统计出来的5006.276123046875ms非常接近，说明上面的异步过程，和同步代码执行过程一致，协程真的是在等待异步过程执行完毕；</li> <li>asyncFunction done.这个是async函数返回的信息，在执行时的then函数中获得，说明整个流程完毕之后参数传递的过程；</li></ul> <h3 id="（2）顺序执行，结果作为下一次输入"><a href="#（2）顺序执行，结果作为下一次输入" aria-hidden="true" class="header-anchor">#</a> （2）顺序执行，结果作为下一次输入</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 传入参数 n，表示这个函数执行的时间（毫秒）
 * 执行的结果是 n + 200，这个值将用于下一步骤
 */</span>
<span class="token keyword">function</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">step1</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">step1 with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">step2</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">step2 with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">step3</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">step3 with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Promise方式调用</span>
<span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> time1 <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
    <span class="token function">step1</span><span class="token punctuation">(</span>time1<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">time2</span> <span class="token operator">=&gt;</span> <span class="token function">step2</span><span class="token punctuation">(</span>time2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">time3</span> <span class="token operator">=&gt;</span> <span class="token function">step3</span><span class="token punctuation">(</span>time3<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">result is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// c:\var\test&gt;node --harmony_async_await .</span>
<span class="token comment">// step1 with 300</span>
<span class="token comment">// step2 with 500</span>
<span class="token comment">// step3 with 700</span>
<span class="token comment">// result is 900</span>
<span class="token comment">// doIt: 1507.251ms</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// async/await方式调用</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> time1 <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> time2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">step1</span><span class="token punctuation">(</span>time1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> time3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">step2</span><span class="token punctuation">(</span>time2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">step3</span><span class="token punctuation">(</span>time3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">result is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="（3）中间参数需要保留"><a href="#（3）中间参数需要保留" aria-hidden="true" class="header-anchor">#</a> （3）中间参数需要保留</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 传入参数 n，表示这个函数执行的时间（毫秒）
 * 执行的结果是 n + 200，这个值将用于下一步骤
 */</span>
<span class="token keyword">function</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">step1</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">step1 with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">step2</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">step2 with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>m<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> and </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span>m <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">step3</span><span class="token punctuation">(</span><span class="token parameter">k<span class="token punctuation">,</span> m<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">step3 with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>m<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> and </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">takeLongTime</span><span class="token punctuation">(</span>k <span class="token operator">+</span> m <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Promise方式调用</span>
<span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> time1 <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
    <span class="token function">step1</span><span class="token punctuation">(</span>time1<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">time2</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">step2</span><span class="token punctuation">(</span>time1<span class="token punctuation">,</span> time2<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">time3</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>time1<span class="token punctuation">,</span> time2<span class="token punctuation">,</span> time3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">times</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">[</span>time1<span class="token punctuation">,</span> time2<span class="token punctuation">,</span> time3<span class="token punctuation">]</span> <span class="token operator">=</span> times<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">step3</span><span class="token punctuation">(</span>time1<span class="token punctuation">,</span> time2<span class="token punctuation">,</span> time3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">result is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// step1 with 300</span>
<span class="token comment">// step2 with 300 and 500</span>
<span class="token comment">// step3 with 300, 500 and 1000</span>
<span class="token comment">// result is 2000</span>
<span class="token comment">// doIt: 2913.488037109375ms</span>
</code></pre></div><blockquote><p>注意：这里为什么不能直接这样写promise式调用，因为中间参数 time2、time3都没有办法保存</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> time1 <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
    <span class="token function">step1</span><span class="token punctuation">(</span>time1<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">time2</span> <span class="token operator">=&gt;</span> <span class="token function">step2</span><span class="token punctuation">(</span>time1<span class="token punctuation">,</span> time2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">time3</span> <span class="token operator">=&gt;</span> <span class="token function">step3</span><span class="token punctuation">(</span>time1<span class="token punctuation">,</span> time2<span class="token punctuation">,</span> time3<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">result is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// async/await方式调用</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> time1 <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> time2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">step1</span><span class="token punctuation">(</span>time1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> time3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">step2</span><span class="token punctuation">(</span>time1<span class="token punctuation">,</span> time2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">step3</span><span class="token punctuation">(</span>time1<span class="token punctuation">,</span> time2<span class="token punctuation">,</span> time3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">result is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;doIt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// step1 with 300</span>
<span class="token comment">// step2 with 300 and 500</span>
<span class="token comment">// step3 with 300, 500 and 1000</span>
<span class="token comment">// result is 2000</span>
<span class="token comment">// doIt: 2913.488037109375ms</span>
</code></pre></div><h2 id="_6、关于协程"><a href="#_6、关于协程" aria-hidden="true" class="header-anchor">#</a> 6、关于协程</h2> <details><summary>关于协程</summary> <ul><li><p>进程&gt;线程&gt;协程</p></li> <li><p>协程的第一大优势是具有极高的执行效率，因为子程序切换不是线程切换，而是由程序自身控制，因此没有线程切换的开销，和多线程比，线程数量越多，协程的性能优势就越明显；</p></li> <li><p>协程的第二大优势是不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多；</p></li> <li><p>协程看上去也是子程序，但执行过程中，在子程序内部可中断，然后转而执行别的子程序，在适当的时候再返回来接着执行，需要注意的是：在一个子程序中中断，去执行其他子程序，这并不是函数调用，有点类似于CPU的中断；</p> <blockquote><p>用汽车和公路举个例子：js公路只是单行道（主线程），但是有很多车道（辅助线程）都可以汇入车流（异步任务完成后回调进入主线程的任务队列）；generator把js公路变成了多车道（协程实现），但是同一时间只有一个车道上的车能开（依然单线程），不过可以自由变道（移交控制权）；</p></blockquote></li> <li><p>协程意思是多个线程互相协作，完成异步任务，运行流程大致如下：
1）协程A开始执行；
2）协程A执行到一半，进入暂停，执行权转移到协程B；
3）一段时间后，协程B交还执行权；
4）协程A恢复执行；</p></li> <li><p>协程是一个无优先级的子程序调度组件，允许子程序在特定的地点挂起恢复；</p></li> <li><p>线程包含于进程，协程包含于线程，只要内存足够，一个线程中可以有任意多个协程，但某一个时刻只能有一个协程在运行，多个协程分享该线程分配到的计算机资源；</p></li> <li><p>就实际使用理解来说，协程允许我们写同步代码的逻辑，却做着异步的事，避免了回调嵌套，使得代码逻辑清晰；</p></li> <li><p>何时挂起，唤醒协程：协程是为了使用异步的优势，异步操作是为了避免IO操作阻塞线程，那么协程挂起的时刻应该是当前协程发起异步操作的时候，而唤醒应该在其他协程退出，并且他的异步操作完成时；</p></li> <li><p>单线程内开启协程，一旦遇到io，从应用程序级别（而非操作系统）控制切换对比操作系统控制线程的切换，用户在单线程内控制协程的切换，优点如下：
1）协程的切换开销更小，属于程序级别的切换，操作系统完全感知不到，因而更加轻量级；
2）单线程内就可以实现并发的效果，最大限度地利用cpu；</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 传统的生产者-消费者模型是一个线程写消息，一个线程取消息，通过锁机制控制队列和等待，但一不小心就可能死锁。</span>

<span class="token comment">// 如果改用协程，生产者生产消息后，直接通过yield跳转到消费者开始执行，待消费者执行完毕后，切换回生产者继续生产，效率极高：</span>
<span class="token keyword">import</span> time

def <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    r <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">while</span> True<span class="token punctuation">:</span>
        n <span class="token operator">=</span> <span class="token keyword">yield</span> r
        <span class="token keyword">if</span> not n<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'[CONSUMER] Consuming %s...'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        r <span class="token operator">=</span> <span class="token string">'200 OK'</span>

def <span class="token function">produce</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>
    c<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span>
        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'[PRODUCER] Producing %s...'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>
        r <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'[PRODUCER] Consumer return: %s'</span> <span class="token operator">%</span> r<span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>
    c <span class="token operator">=</span> <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">produce</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token constant">PRODUCER</span><span class="token punctuation">]</span> Producing <span class="token number">1.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token constant">CONSUMER</span><span class="token punctuation">]</span> Consuming <span class="token number">1.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token constant">PRODUCER</span><span class="token punctuation">]</span> Consumer <span class="token keyword">return</span><span class="token punctuation">:</span> <span class="token number">200</span> <span class="token constant">OK</span>
<span class="token punctuation">[</span><span class="token constant">PRODUCER</span><span class="token punctuation">]</span> Producing <span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token constant">CONSUMER</span><span class="token punctuation">]</span> Consuming <span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token constant">PRODUCER</span><span class="token punctuation">]</span> Consumer <span class="token keyword">return</span><span class="token punctuation">:</span> <span class="token number">200</span> <span class="token constant">OK</span>
<span class="token punctuation">[</span><span class="token constant">PRODUCER</span><span class="token punctuation">]</span> Producing <span class="token number">3.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token constant">CONSUMER</span><span class="token punctuation">]</span> Consuming <span class="token number">3.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token constant">PRODUCER</span><span class="token punctuation">]</span> Consumer <span class="token keyword">return</span><span class="token punctuation">:</span> <span class="token number">200</span> <span class="token constant">OK</span>
<span class="token punctuation">[</span><span class="token constant">PRODUCER</span><span class="token punctuation">]</span> Producing <span class="token number">4.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token constant">CONSUMER</span><span class="token punctuation">]</span> Consuming <span class="token number">4.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token constant">PRODUCER</span><span class="token punctuation">]</span> Consumer <span class="token keyword">return</span><span class="token punctuation">:</span> <span class="token number">200</span> <span class="token constant">OK</span>
<span class="token punctuation">[</span><span class="token constant">PRODUCER</span><span class="token punctuation">]</span> Producing <span class="token number">5.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token constant">CONSUMER</span><span class="token punctuation">]</span> Consuming <span class="token number">5.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token constant">PRODUCER</span><span class="token punctuation">]</span> Consumer <span class="token keyword">return</span><span class="token punctuation">:</span> <span class="token number">200</span> <span class="token constant">OK</span>
</code></pre></div><p>注意到consumer函数是一个generator（生成器），把一个consumer传入produce后：</p> <ul><li>首先调用c.next()启动生成器；</li> <li>然后，一旦生产了东西，通过c.send(n)切换到consumer执行；</li> <li>consumer通过yield拿到消息，处理，又通过yield把结果传回；</li> <li>produce拿到consumer处理的结果，继续生产下一条消息；</li> <li>produce决定不生产了，通过c.close()关闭consumer，整个过程结束。</li></ul> <p>整个流程无锁，由一个线程执行，produce和consumer协作完成任务，所以称为“协程”，而非线程的抢占式多任务。</p></details> <p>参考链接：<a href="https://www.jianshu.com/p/73b070eebf50" target="_blank" rel="noopener noreferrer">async/await的基础用法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://juejin.im/post/5dc28ea66fb9a04a881d1ac0" target="_blank" rel="noopener noreferrer">async/await 原理及执行顺序分析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/22/2019, 5:09:45 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Roundtable/Question-Bank/basic-grammar/variablesAndTypes5.html" class="prev">JS专题-变量与类型-(5)JS的类型判断方法</a></span> <span class="next"><a href="/Roundtable/Question-Bank/basic-grammar/flatten-array.html">数组扁平化</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Roundtable/assets/js/app.d395b3ed.js" defer></script><script src="/Roundtable/assets/js/2.a96cdc04.js" defer></script><script src="/Roundtable/assets/js/37.8c464367.js" defer></script>
  </body>
</html>
